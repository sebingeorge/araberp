@model  ArabErp.Domain.SaleOrder
@{ ViewBag.Title = "Create SaleOrder"; Layout = "~/Views/Shared/_Layout.cshtml"; }
@{ string actionName = ViewContext.RouteData.GetRequiredString("action");
   ViewData["action"] = actionName;}

<script>


    $(function () {
        $("#SaleOrderDate").datepicker({ dateFormat: "dd-MM-yy" });
        $("#EDateArrival").datepicker({ dateFormat: "dd-MM-yy" });
        $("#EDateDelivery").datepicker({ dateFormat: "dd-MM-yy" });
     
        
    });
    function CustomerChanged(cust)
    {
        var cusId = cust.value;

        $.ajax({
            url:  "@Url.Action("GetCustomerDetailsByKey", "SaleOrder")",
            data: { cusKey: cusId },
            cache: false,
            type: "GET",
            timeout: 10000,
            dataType: "json",
            success: function (result) {
                if (result.Success) { // this sets the value from the response
                    $('#CurrencyId').val(result.CurrencyId);
                    $('#CurrencyName').val(result.CurrencyName);
                    $("#CustomerAddress").val(result.Address);
                } else {
                    $('#SomeOtherHtmlTextBox').val("Failed");
                }
            }
        });
        //$('#CurrencyId').val("2");
    }
     function Validation() {
        var count = 0;

         if ($('#CustomerId').val() == '') {
            alert("select one customer...");
            $('#CustomerId').focus();
            return false;
        }
        else if ($('#CustomerOrderRef').val() == '') {
            alert("please enter customer order ref.");
            $('#CustomerOrderRef').focus();
            return false;
        }
        else if ($('#PaymentTermsId').val() == '') {
            alert("select payment terms");
            $('#PaymentTermsId').focus();
            return false;
        }
        else if ($('#CommissionAgentId').val() == '') {
            alert("select commission agent");
            $('#CommissionAgentId').focus();
            return false;
        }
        else if ($('#CommissionPerc').val() == '') {
            alert("please enter commission percentage.");
            $('#CommissionPerc').focus();
            return false;
        }
        else if ($('#SalesExecutiveId').val() == '') {
            alert("select order taken by");
            $('#SalesExecutiveId').focus();
            return false;
        }
        else if ($('#EDateArrival').val() == '') {
            alert("select EDA");
            $('#EDateArrival').focus();
            return false;
        }
        else if ($('#EDateDelivery').val() == '') {
            alert("select EDD");
            $('#EDateDelivery').focus();
            return false;
        }
        else if ($('#EDateDelivery').val() < $('#EDateArrival').val()) {
            alert("Please select a valid Delivery Date, Delivery Date should be greater than Arrival Date");
            $('#EDateDelivery').focus();
            return false;
        }


        $(".validateqty").each(function (i, obj) {

            var qty = $("#Items_" + i + "__Quantity").val();
            var rate = $("#Items_" + i + "__Rate").val();
            var wrk = $("#Items_" + i + "__WorkDescriptionId").val();
            var unit = $("#Items_" + i + "__UnitId").val();
            var discount = $("#Items_" + i + "__Discount").val();
            var amount = $("#Items_" + i + "__Amount").val();
            if (wrk == "") {

                alert("select work description");
                $("#Items_" + i + "__WorkDescriptionId").focus();
                count = 1;
            }
           else if (qty == "") {

                alert("Please enter qty.");
                $("#Items_" + i + "__Quantity").focus();
                count = 1;
           }
           else if (unit == "") {

               alert("select unit.");
               $("#Items_" + i + "__UnitId").focus();
               count = 1;
           }
            else if (rate == "") {

                alert("Please enter rate");
                $("#Items_" + i + "__Rate").focus();
                count = 1;
            }

            else if (discount > amount) {

                alert("Please enter valid discount.");
                $("#Items_" + i + "__Discount").focus();
                count = 1;
            }



        });


        if (count == 1) {

            return false;
        }


        return (confirm("Are you sure to save?")) ? true : false;



     }
     $(document).ready(function () {
         //bind keypress event for new row inputs.
         $(".numbers-only").keypress(function (e) {
             if (e.which == 8 || (e.which == 46 && $(this).val().indexOf('.') == -1) || (e.which > 47 && e.which < 58)) { } else { return false; }
         });
     });

     function Exit() {
        
         location.href = '@Url.Action("Index","Home")';
    }
</script>
@Html.HiddenFor(m => m.SaleOrderId)
<div class="container">
        <div class="row">
                <div class="form-head1">
    <h4>Sale Order</h4>
                </div>
              
                <div class="main-part pad1">
                    @using (Html.BeginForm("Save", null, FormMethod.Post, new { @class = "createFrom", @id = "saleorder_form", onsubmit = "return Validation()" }))
        {
                     
@Html.Partial("_SaleOrderHead",Model)
@Html.Partial("_DisplaySOList", Model)
@Html.Partial("_SaleOrderFooter", Model)
                <div class="row">
        <div class="col-md-12 hrpart">
            <button type="button" class="form-button right" onclick="Exit()">Exit</button>
            <button type="submit" class="form-button right">Save</button>
        </div>

    </div>            

        }
    </div>
</div>
    </div>





